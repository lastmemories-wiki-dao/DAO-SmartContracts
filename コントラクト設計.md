# **DAOトレジャリー & タスク決済システム設計まとめ**

## **📌 必要なスマートコントラクト**
以下の **4つのコントラクト** で構成。

---

## **1️⃣ DAOトレジャリー (`DAOTreasury`)**
📌 **役割**  
- DAOの資金管理（ETH・ERC-20）
- タスク報酬の送金（承認済みのもののみ）

🔹 **必要なメソッド**
- `deposit()` → DAOに資金を預ける
- `getBalance()` → DAOのETH残高を確認
- `executePayout(uint taskId, address recipient, uint amount)` → **承認済みのタスク報酬を支払う**
- `isApproved(uint taskId)` → **タスクが承認済みか確認**

---

## **2️⃣ タスク管理 (`TaskManager`)**
📌 **役割**  
- タスク完了報告 & 報酬請求の管理
- 承認状況のトラッキング（決済者が承認するまで）

🔹 **必要なメソッド**
- `reportTaskCompletion(uint taskId, address recipient, uint amount)` → **タスク完了報告 & 報酬請求**
- `approveTask(uint taskId)` → **決済者がタスクを承認**
- `getApprovedAmount(uint taskId)` → **タスクの承認金額を確認**
- `isApproved(uint taskId)` → **タスクが承認済みか確認（DAOトレジャリー向け）**

---

## **3️⃣ 決済者管理 (`PaymentApprover`)**
📌 **役割**  
- 決済者のグレード & 決済可能金額の管理
- 経験値システム（グレードアップ / ダウン）

🔹 **必要なメソッド**
- `registerApprover(address approver, uint grade)` → **決済者を登録**
- `increaseXP(address approver, uint xp)` → **経験値を増やす**
- `decreaseXP(address approver, uint xp)` → **経験値を減らす**
- `getApproverGrade(address approver)` → **決済者のグレードを取得**
- `getAvailableBudget(address approver)` → **決済可能な金額を取得**
- `canApprove(uint taskId, address approver, uint amount)` → **決済者が承認できるか判定**
- `approveTask(uint taskId, address approver)` → **決済者がタスクを承認（制限付き）**

---

## **4️⃣ マルチシグ承認 (`MultiSigApprover`)**
📌 **役割**  
- **決済者の追加・削除をマルチシグで管理**
- **承認に必要な割合（しきい値）をマルチシグで変更**

🔹 **必要なメソッド**
### **🔹 承認者の追加・削除**
- `proposeAddSigner(address newSigner)` → **マルチシグの承認者を追加する提案**
- `proposeRemoveSigner(address signer)` → **マルチシグの承認者を削除する提案**
- `executeAddSigner(uint proposalId)` → **マルチシグ承認後に実行**
- `executeRemoveSigner(uint proposalId)` → **マルチシグ承認後に実行**

### **🔹 承認に必要な割合（しきい値）の変更**
- `proposeChangeThreshold(uint newThreshold)` → **承認に必要な割合を変更する提案**
- `executeChangeThreshold(uint proposalId)` → **マルチシグ承認後に実行**

---

## **📌 設計の流れ**
1. **タスク完了者が報酬請求 (`TaskManager`)**
   - `reportTaskCompletion(taskId, recipient, amount)`

2. **決済者がタスクを承認 (`PaymentApprover`)**
   - `approveTask(taskId)`

3. **DAOトレジャリーが承認状況を確認 (`DAOTreasury`)**
   - `isApproved(taskId)`

4. **DAOトレジャリーが報酬を支払う (`DAOTreasury`)**
   - `executePayout(taskId, recipient, amount)`

5. **決済者の追加・削除はマルチシグで管理 (`MultiSigApprover`)**
   - `proposeAddSigner()` / `proposeRemoveSigner()` → 提案
   - `approveProposal()` → 承認
   - `executeAddSigner()` / `executeRemoveSigner()` → 追加 or 削除実行

---

## **📌 まとめ**
✅ **DAOトレジャリー (`DAOTreasury`)** → 資金管理 & 報酬支払い  
✅ **タスク管理 (`TaskManager`)** → タスク完了報告 & 承認  
✅ **決済者管理 (`PaymentApprover`)** → 決済者のグレード・経験値・承認金額管理  
✅ **マルチシグ承認 (`MultiSigApprover`)** → **決済者 & 承認者の管理をマルチシグで制御**  

---
